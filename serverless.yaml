service: "nestfibot"
frameworkVersion: "3"
useDotenv: true
params:
  prod:
    BOT_TOKEN: ${env:PROD_BOT_TOKEN}
    UPSTASH_REDIS_REST_URL: ${env:PROD_UPSTASH_REDIS_REST_URL}
    UPSTASH_REDIS_REST_TOKEN: ${env:PROD_UPSTASH_REDIS_REST_TOKEN}
    CHAIN_ID: ${env:PROD_CHAIN_ID}
    HOSTNAME: ${env:PROD_HOSTNAME}
  dev:
    BOT_TOKEN: ${env:DEV_BOT_TOKEN}
    UPSTASH_REDIS_REST_URL: ${env:DEV_UPSTASH_REDIS_REST_URL}
    UPSTASH_REDIS_REST_TOKEN: ${env:DEV_UPSTASH_REDIS_REST_TOKEN}
    CHAIN_ID: ${env:DEV_CHAIN_ID}
    HOSTNAME: ${env:DEV_HOSTNAME}
package:
  patterns:
    - "app.js"
    - "locales/**"
  individually: true
  excludeDevDependencies: true
provider:
  name: "aws"
  deploymentMethod: "direct"
  runtime: "nodejs16.x"
  region: "ap-northeast-1"
plugins:
  - "serverless-plugin-typescript"
  - "serverless-dotenv-plugin"
functions:
  app:
    name: NESTFiBot-${sls:stage}
    handler: "app.handler"
    timeout: 14
    memorySize: 256
    environment:
      BOT_TOKEN: ${param:BOT_TOKEN}
      UPSTASH_REDIS_REST_URL: ${param:UPSTASH_REDIS_REST_URL}
      UPSTASH_REDIS_REST_TOKEN: ${param:UPSTASH_REDIS_REST_TOKEN}
      CHAIN_ID: ${param:CHAIN_ID}
      HOSTNAME: ${param:HOSTNAME}
    events:
      - httpApi:
          path: "/bot"
          method: "post"
